function BaseConnect(e){this.config=e,this.inverseConfig=BaseHelpers.inverseConfig(e),this.apptoken=null,this.async=null,this.post=function(e,t,n){var r=e.type||"API",i=r+"_"+e.action,a=this.buildPostData(e.dbid,e);if(e.dbid)if(this.config)var o=this.config[e.dbid].dbid;else var o=e.dbid;else var o="main";return this.xmlPost(o,i,a,t,n)},this.generateQuickbaseQuery=function(e){var t=[],n=function(e,t){return"{'"+e+"'.EX.'"+t+"'}"},r=function(e,t){var n=Object.keys(t)[0],r=t[n],i="";if("in"==n){var a=[];r.forEach(function(t){a.push("{'"+e+"'.EX.'"+t+"'}")}),i="("+a.join("OR")+")"}else i="{'"+e+"'."+n+".'"+r+"'}";return i},i=function(e,t){var i=[];return t.forEach(function(e){var t=Object.keys(e)[0],a=e[t];if("object"==typeof a){var e=r(t,a);i.push(e)}else{var e=n(t,a);i.push(e)}}),"("+i.join("OR")+")"};for(key in e){var a=e[key],o="";o="or"==key?i(key,a):"object"==typeof a?r(key,a):n(key,e[key]),t.push(o)}return t=t.join("AND")},this.replaceFieldNames=function(e,t){var n=this.config;return e=e.split(/(AND|OR)/).map(function(e){if("AND"!=e&&"OR"!=e){var r=e.match(/\{'*(.*)'\..*'/)[1];if(isNaN(r)){var i=n[t][r];e=e.replace(r,i)}}return e}),e.join("")},this.replaceOptionFieldNames=function(e,t){var n=this.config;return e=e.split("."),e=e.map(function(e){if(isNaN(e)){var r=n[t][e];return r}return e}),e.join(".")},this.handleXMLCharacters=function(e){return e.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},this.buildPostData=function(e,t){var n=["<qdbapi>"];this.apptoken&&n.push(this.createParameter("apptoken",this.apptoken));for(key in t.params){var r=t.params[key];"clist"==key||"slist"==key||"options"==key?("object"==typeof r&&(r=r.join(".")),!this.config||"clist"!=key&&"slist"!=key||r&&(r=this.replaceOptionFieldNames(r,e))):"query"==key&&(r=this.generateQuickbaseQuery(r),this.config&&(r=this.replaceFieldNames(r,e))),r&&n.push(this.createParameter(key,r))}for(field in t.fieldParams){if(this.config)var i=this.config[e][field];else var i=field;var a=this.handleXMLCharacters(t.fieldParams[field]);n.push(this.createFieldParameter(i,a))}for(key in t.fidParams)n.push(this.createFidParameter(key,t.fidParams[key]));return t.csvData&&n.push(this.createCSVParameter(t.csvData)),n.push("</qdbapi>"),n.join("")},this.getNode=function(e,t){return $(e).find(t).text()},this.getRecords=function(e,t){for(var n=$(t).find("records").find("record"),r=[],i=0;i<n.length;i++){var a=n[i],o=$(a).find("f");a={};for(var s=0;s<o.length;s++){var d=o[s],c=parseInt($(d).attr("id"));if(""!=$(d).find("url").text())var u=$(d).find("url").text(),h=u.split("/"),f=h[h.length-1],l={filename:f,url:u};else var l=$(d).text();if(this.config){var p=this.inverseConfig[e];p[c]&&(c=p[c.toString()],a[c]=l)}else a[c]=l}r.push(a)}return r},this.getRids=function(e){for(var t=$(e).find("records").find("record"),n=[],r=0;r<t.length;r++){var i=t[r];n.push($(i).find('f[id="3"]').text())}return n},this.getNewRids=function(e){for(var t=$(e).find("rids").find("rid"),n=[],r=0;r<t.length;r++){var i=parseInt($(t[r]).text());n.push(i)}return n},this.getFields=function(e){for(var t=$(e).find("fields").find("field"),n={},r=0;r<t.length;r++){var i=t[r],a={label:$(i).find("label").text(),nowrap:$(i).find("nowrap").text(),bold:$(i).find("bold").text(),required:$(i).find("required").text(),appears_by_default:$(i).find("appears_by_default").text(),find_enabled:$(i).find("find_enabled").text(),allow_new_choices:$(i).find("allow_new_choices").text(),sort_as_given:$(i).find("sort_as_given").text(),carrychoices:$(i).find("carrychoices").text(),foreignkey:$(i).find("foreignkey").text(),unique:$(i).find("unique").text(),doesdatacopy:$(i).find("doesdatacopy").text(),fieldhelp:$(i).find("fieldhelp").text(),display_user:$(i).find("display_user").text(),default_kind:$(i).find("default_kind").text()};n[$(i).attr("id")]=a}return n},this.getReports=function(e){for(var t=$(e).find("queries").find("query"),n={},r=0;r<t.length;r++){var i=t[r],a={name:$(i).find("qyname").text(),type:$(i).find("qytype").text(),criteria:$(i).find("qycrit").text(),clist:$(i).find("qyclst").text(),slist:$(i).find("qyslst").text(),options:$(i).find("qyopts").text()};n[$(i).attr("id")]=a}return n},this.formatUserRoles=function(e){for(var t=$(e).find("users").find("user"),n=[],r=0;r<t.length;r++){for(var i=t[r],a=$(i).find("roles").find("role"),o=[],s=0;s<a.length;s++){var d=a[s],c={id:$(d).attr("id"),name:$(d).find("name").text(),accessId:$(d).find("access").attr("id"),access:$(d).find("access").text()};o.push(c)}var u={id:$(i).attr("id"),firstName:$(i).find("firstName").text(),lastName:$(i).find("lastName").text(),lastAccess:$(i).find("lastAccess").text(),lastAccessAppLocal:$(i).find("lastAccessAppLocal").text(),roles:o};n.push(u)}return n},this.createParameter=function(e,t){return"<"+e+">"+t+"</"+e+">"},this.createFieldParameter=function(e,t){var n="<field fid='"+e+"'";return t?t.filename?(n+=" filename='"+t.filename+"'>",n+=this.base64Encode(t.body)):(n+=">",n+=t):n+=">",n+="</field>"},this.createFidParameter=function(e,t){return"<_fid_"+e+">"+t+"</_fid_"+e+">"},this.createCSVParameter=function(e){return"<records_csv><![CDATA["+e+"]]></records_csv>"},this.base64Encode=function(e){for(var t,n,r,i,a,o,s,d="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=0,h=e.replace(/\r\n/g,"\n"),f="",l=0;l<h.length;l++){var p=h.charCodeAt(l);128>p?f+=String.fromCharCode(p):p>127&&2048>p?(f+=String.fromCharCode(p>>6|192),f+=String.fromCharCode(63&p|128)):(f+=String.fromCharCode(p>>12|224),f+=String.fromCharCode(p>>6&63|128),f+=String.fromCharCode(63&p|128))}for(e=f;u<e.length;)t=e.charCodeAt(u++),n=e.charCodeAt(u++),r=e.charCodeAt(u++),i=t>>2,a=(3&t)<<4|n>>4,o=(15&n)<<2|r>>6,s=63&r,isNaN(n)?o=s=64:isNaN(r)&&(s=64),d=d+c.charAt(i)+c.charAt(a)+c.charAt(o)+c.charAt(s);return d},this.xmlPost=function(e,t,n,r,i){var a="/db/"+e+"?act="+t;if(!this.async){var o=null;return $.ajax({url:a,type:"POST",context:this,contentType:"text/xml",data:n,dataType:"xml",async:!1,success:function(e){o=i(e)}}),o}$.ajax({url:a,type:"POST",context:this,contentType:"text/xml",data:n,dataType:"xml",success:function(e){return r(i(e))}})},this.parseResponse=function(e){var t=this.getNode(e,"errcode");return"0"!=t&&console.log("*****ERROR*****: ("+this.getNode(e,"action")+")(CODE: "+t+")","MESSAGE: "+this.getNode(e,"errtext")+" - "+this.getNode(e,"errdetail")),this.ticket=this.getNode(e,"ticket"),e},this.setVariables=function(e,t){this.apptoken=e,this.async=t||!1},this.initHttpConnection=function(e){var t=null;this.context=e;try{t||(t=new XMLHttpRequest)}catch(n){}try{t||(t=new ActiveXObject("Msxml2.XMLHTTP"))}catch(n){}try{t||(t=new ActiveXObject("Microsoft.XMLHTTP"))}catch(n){alert("This browser does not support BaseJS.")}return t}}function Base(e){var t=new BaseConnect(e.config);t.setVariables(e.token,e.async),this.getOneTimeTicket=function(e){this.handle=function(e){return t.getNode(e,"ticket")};var n={action:"GetOneTimeTicket"};return t.post(n,e,this.handle)},this.authenticate=function(e,n,r){this.handle=function(e){return t.getNode(e,"ticket")};var i={action:"Authenticate",params:{ticket:e,hours:n}};return t.post(i,r,this.handle)},this.signOut=function(e){this.handle=function(e){var n=t.getNode(e,"errcode");return"0"==n?!0:!1};var n={action:"SignOut"};return t.post(n,e,this.handle)},this.getDBVar=function(e,n,r){this.handle=function(e){return t.getNode(e,"value")};var i={dbid:e,action:"GetDBvar",params:{varname:n}};return t.post(i,r,this.handle)},this.setDBVar=function(e,n,r,i){this.handle=function(){return!0};var a={dbid:e,action:"SetDBvar",params:{varname:n,value:r}};return t.post(a,i,this.handle)},this.uploadPage=function(e,n,r,i,a){this.handle=function(e){return t.getNode(e,"pageID")};var o={pagetype:"1",pagebody:i};n?o.pageid=n:r&&(o.pagename=r);var s={dbid:e,action:"AddReplaceDBPage",params:o};return t.post(s,a,this.handle)},this.deletePage=function(e,n,r){this.handle=function(e){var n=t.getNode(e,"errcode");return"0"==n?!0:!1};var i={dbid:e,action:"PageDelete",type:"QBI",params:{pageid:n}};return t.post(i,r,this.handle)},this.getDbPage=function(e,n,r){this.handle=function(e){return t.getNode(e,"pagebody")};var i={dbid:e,action:"GetDBPage",type:"API",params:{pageID:n}};return t.post(i,r,this.handle)},this.cloneDatabase=function(e,n,r){this.handle=function(e){return t.getNode(e,"newdbid")};var i={dbid:e,action:"CloneDatabase",type:"API",params:n};return t.post(i,r,this.handle)},this.createDatabase=function(e,n,r,i){this.handle=function(e){return t.getNode(e,"dbid")};var a={action:"CreateDatabase",type:"API",params:{dbname:e,dbdesc:n,createapptoken:r||!1}};return t.post(a,i,this.handle)},this.deleteDatabase=function(e,n){this.handle=function(e){var n=t.getNode(e,"errcode");return"0"==n?!0:!1};var r={dbid:e,action:"DeleteDatabase",type:"API"};return t.post(r,n,this.handle)},this.renameApp=function(e,n,r){this.handle=function(e){var n=t.getNode(e,"errcode");return"0"==n?!0:!1};var i={dbid:e,action:"RenameApp",type:"API",params:{newappname:n}};return t.post(i,r,this.handle)},this.findDbByName=function(e,n){this.handle=function(e){return t.getNode(e,"dbid")};var r={action:"FindDBByName",type:"API",params:{dbname:e}};return t.post(r,n,this.handle)},this.getAncestorInfo=function(e,n){this.handle=function(e){var n={ancestorAppId:t.getNode(e,"ancestorappid"),oldestAncestorAppId:t.getNode(e,"oldestancestorappid")};return n};var r={dbid:e,action:"GetAncestorInfo",type:"API"};return t.post(r,n,this.handle)},this.getAppDtmInfo=function(e,n){this.handle=function(e){for(var n={},r=$(e).find("tables").find("table"),i=0;i<r.length;i++){var a=r[i],o={lastModifiedTime:$(a).find("lastModifiedTime").text(),lastRecModTime:$(a).find("lastRecModTime").text()};n[$(a).attr("id")]=o}var s={requestTime:t.getNode(e,"RequestTime"),requestNextAllowedTime:t.getNode(e,"RequestNextAllowedTime"),lastModifiedTime:t.getNode(e,"lastModifiedTime"),lastRecModTime:t.getNode(e,"lastRecModTime"),tables:n};return s};var r={action:"GetAppDTMInfo",type:"API",params:{dbid:e}};return t.post(r,n,this.handle)},this.getDbInfo=function(e,n){this.handle=function(e){var n={dbname:t.getNode(e,"dbname"),lastRecModTime:t.getNode(e,"lastRecModTime"),createdTime:t.getNode(e,"createdTime"),numRecords:t.getNode(e,"numRecords"),mgrID:t.getNode(e,"mgrID"),mgrName:t.getNode(e,"mgrName"),version:t.getNode(e,"version"),time_zone:t.getNode(e,"time_zone")};return n};var r={dbid:e,action:"GetDBInfo",type:"API"};return t.post(r,n,this.handle)},this.grantedDbs=function(e,n){this.handle=function(e){for(var n=[],r=$(e).find("databases").find("dbinfo"),i=0;i<r.length;i++){var a=r[i],o={dbname:t.getNode(a,"dbname"),dbid:t.getNode(a,"dbid")};n.push(o)}return n};var r={action:"GrantedDBs",type:"API",params:e};return t.post(r,n,this.handle)},this.doQuery=function(e,n,r,i){this.handle=function(n){return t.getRecords(e,n,"records")};var a={fmt:"structured"};n.query||n.qid?n.query?a.query=n.query:a.qid=n.qid:a.query="{'3'.XEX.''}",a.clist=n.clist||"a",a.slist=n.slist,a.options=n.options;var o={dbid:e,action:"DoQuery",params:a};return i&&(this.handle=i),t.post(o,r,this.handle)},this.doQueryCount=function(e,n,r){this.handle=function(e){return t.getNode(e,"numMatches")};var i={dbid:e,action:"DoQueryCount",params:{query:n}};return t.post(i,r,this.handle)},this.find=function(e,n,r){this.handle=function(n){var r=t.getRecords(e,n,"records");return r.length>0?r.length>1?r:r[0]:{}};var i=[];if("[object Array]"==Object.prototype.toString.call(n))for(var a=0;a<n.length;a++)i.push("{'3'.EX.'"+n[a]+"'}");else i.push("{'3'.EX.'"+n+"'}");return i=i.join("OR"),this.doQuery(e,{query:i},r,this.handle)},this.first=function(e,n,r){return this.handle=function(n){var r=t.getRecords(e,n,"records");return r.length>0?r[0]:{}},this.doQuery(e,n,r,this.handle)},this.last=function(e,n,r){return this.handle=function(n){var r=t.getRecords(e,n,"records");return r.length>0?r[r.length-1]:{}},this.doQuery(e,n,r,this.handle)},this.all=function(e,n,r){return this.handle=function(n){var r=t.getRecords(e,n,"records");return r.length>0?r:{}},n||(n={}),n.query="{'3'.XEX.''}",this.doQuery(e,n,r,this.handle)},this.getRids=function(e,n,r){return this.handle=function(e){return t.getRids(e)},n||(n={}),n.clist="3",this.doQuery(e,n,r,this.handle)},this.genAddRecordForm=function(e,n,r){this.handle=function(e){return e};var i={dbid:e,action:"GenAddRecordForm",fidParams:n};return t.post(i,r,this.handle)},this.getNumRecords=function(e,n){this.handle=function(e){return parseInt(t.getNode(e,"num_records"))};var r={dbid:e,action:"GetNumRecords"};return t.post(r,n,this.handle)},this.getRecordInfo=function(e,n,r){this.handle=function(e){for(var n={},r=$(e).find("field"),i=0;i<r.length;i++){var a=r[i],o={name:t.getNode(a,"name"),type:t.getNode(a,"type"),value:t.getNode(a,"value")};n[$(a).find("fid").text()]=o}var s={rid:t.getNode(e,"rid"),num_fields:t.getNode(e,"num_fields"),update_id:t.getNode(e,"update_id"),fields:n};return s};var i={dbid:e,action:"GetRecordInfo",params:{rid:n}};return t.post(i,r,this.handle)},this.importFromCSV=function(e,n,r){this.handle=function(e){return t.getNewRids(e)};var i="",a=[];for(key in n[0])t.config&&(tableConfig=t.config[e],key=tableConfig[key]),a.push(key);a=a.join(".");for(var o=0;o<n.length;o++){var s=n[o],d=[];for(key in s)value=s[key],value=value.toString().replace(/"/g,'""'),d.push('"'+value+'"');d.join(","),d+="\n",i+=d}var c={dbid:e,action:"ImportFromCSV",params:{clist:a},csvData:i};return t.post(c,r,this.handle)},this.addRecord=function(e,n,r){this.handle=function(e){return parseInt(t.getNode(e,"rid"))};var i={dbid:e,action:"AddRecord",fieldParams:n};return t.post(i,r,this.handle)},this.editRecord=function(e,n,r,i){this.handle=function(e){var n=t.getNode(e,"rid");return n?!0:!1};var a={dbid:e,action:"EditRecord",fieldParams:r,params:{rid:n}};return t.post(a,i,this.handle)},this.changeRecordOwner=function(e,n,r,i){this.handle=function(){return!0};var a={dbid:e,action:"ChangeRecordOwner",params:{rid:n,newowner:r}};return t.post(a,i,this.handle)},this.copyMasterDetail=function(e,n,r){this.handle=function(e){return t.getNode(e,"numCreated")};var i={dbid:e,action:"CopyMasterDetail",params:n};return t.post(i,r,this.handle)},this.deleteRecord=function(e,n,r){this.handle=function(e){var n=t.getNode(e,"rid");return n?!0:!1};var i={dbid:e,action:"DeleteRecord",params:{rid:n}};return t.post(i,r,this.handle)},this.purgeRecords=function(e,n,r){this.handle=function(e){var n=t.getNode(e,"num_records_deleted");return parseInt(n)};var i={dbid:e,action:"PurgeRecords",params:{query:n}};return t.post(i,r,this.handle)},this.setFieldProperties=function(e,n,r,i){this.handle=function(e){var n=t.getNode(e,"errcode");return 0==n?!0:!1},r.fid=n;var a={dbid:e,action:"SetFieldProperties",params:r};return t.post(a,i,this.handle)},this.getUserInfo=function(e,n){this.handle=function(e){var t=$(e).find("user");return t={id:$(t).attr("id"),firstName:$(t).find("firstName").text(),lastName:$(t).find("lastName").text(),login:$(t).find("login").text(),email:$(t).find("email").text(),screenName:$(t).find("screenName").text(),isVerified:$(t).find("isVerified").text(),externalAuth:$(t).find("externalAuth").text()}},e||(e="");var r={action:"GetUserInfo",params:{email:e}};return t.post(r,n,this.handle)},this.getUserRoles=function(e,n){this.handle=function(e){return t.formatUserRoles(e)};var r={dbid:e,action:"UserRoles"};return t.post(r,n,this.handle)},this.changeUserRole=function(e,n,r,i,a){this.handle=function(){return!0};var o={dbid:e,action:"ChangeUserRole",params:{userId:n,roleId:r}};return i&&(o.params.newRoleId=i),t.post(o,a,this.handle)},this.getTableFields=function(e,n){this.handle=function(e){return t.getFields(e)};var r={dbid:e,action:"GetSchema"};return t.post(r,n,this.handle)},this.getTableReports=function(e,n){this.handle=function(e){return t.getReports(e)};var r={dbid:e,action:"GetSchema"};return t.post(r,n,this.handle)}}var BaseHelpers={options:{timeZone:"utc",format:"hours"},inverseConfig:function(e){var t={};for(var n in e){var r={};for(var i in e[n])r[e[n][i].toString()]=i;t[n]=r}return t},getUrlParam:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},formatDateElement:function(e){return e=e.toString(),1==e.length&&(e="0"+e),e},dateToString:function(e){if(e){var t=new Date(parseInt(e)),n=this.formatDateElement(t.getUTCMonth()+1),r=this.formatDateElement(t.getUTCDate());return t=[n,r,t.getUTCFullYear()].join("-")}return" "},dateTimeToString:function(e,t){var n=new Date,t=t?t.toLowerCase().trim():this.options.timeZone.toLowerCase();Date.prototype.stdTimezoneOffset=function(){var e=new Date(this.getFullYear(),0,1),t=new Date(this.getFullYear(),6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())},Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};var r={utc:0,eastern:n.dst()?-4:-5,central:n.dst()?-5:-6,mountain:n.dst()?-6:-7,pacific:n.dst()?-7:-8},i=r[t];if(e){var a=new Date(parseInt(e)+36e5*i),o=(this.formatDateElement(a.getUTCFullYear),this.formatDateElement(a.getUTCMonth()+1)),s=this.formatDateElement(a.getUTCDate()),d=this.formatDateElement(a.getUTCHours()),c=this.formatDateElement(a.getUTCMinutes()),u=(this.formatDateElement(a.getUTCSeconds()),[o,s,a.getUTCFullYear()].join("-")),h=parseInt(d)>=12?"PM":"AM";return d%=12,d=d?d:12,u+=" ",u+=[d,c].join(":"),u+=" "+h}return""},durationToString:function(e,t){var n,r=parseInt(e),t=t?t.trim().toLowerCase():this.options.format.toLowerCase(),i={days:function(){return r/864e5},hours:function(){return r/36e5},minutes:function(){return r/6e4},seconds:function(){return r/1e3}};return e?(i[t]?n=i[t]():(n=i.hours(),console.log("The format parameter passed to BaseHelpers.durationToString() was incorrect. Using the format for 'hours' instead.")),n=Math.round(100*n)/100,n.toString()):""},timeOfDayToString:function(e){var t="";t=new Date,t.setHours(""),t.setMinutes(""),t.setSeconds(""),t.setMilliseconds(e);var n=t.getHours().toString(),r=t.getMinutes().toString(),i=n>12?"pm":"am";return n%=12,n=n?n:12,r=r.length>1?r:"0"+r,t=n+":"+r+" "+i},redirectToEditForm:function(e,t){window.location="/db/"+e+"?a=er&rid="+t},redirectToViewForm:function(e,t){window.location="/db/"+e+"?a=dr&rid="+t},downloadFile:function(e,t,n,r){var r=r||0;window.location="https://www.quickbase.com/up/"+e+"/a/r"+t+"/e"+n+"/v"+r}};