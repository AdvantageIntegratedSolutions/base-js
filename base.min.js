function Base(e){this.apptoken=e;this.httpConnection=null;BaseConnect.initHttpConnection();this.getTicket=function(){var e=BaseConnect.post("main","GetOneTimeTicket");var t=BaseConnect.getNode(e,"ticket");return t};this.addRecord=function(e,t){var n=BaseConnect.post(e,"AddRecord",t);var r=parseInt(BaseConnect.getNode(n,"rid"));return r};this.editRecord=function(e,t,n){var r=BaseConnect.post(e,"EditRecord",n,{rid:t});var t=BaseConnect.getNode(r,"rid");if(t){return true}else{return false}};this.deleteRecord=function(e,t){var n=BaseConnect.post(e,"DeleteRecord",{},{rid:t});var t=BaseConnect.getNode(n,"rid");if(t){return true}else{return false}};this.find=function(e,t){var n=[];if(Object.prototype.toString.call(t)=="[object Array]"){for(var r=0;r<t.length;r++){n.push("{'3'.EX.'"+t[r]+"'}")}}else{n.push("{'3'.EX.'"+t+"'}")}n=n.join("OR");var i=this.doQuery(e,{query:n});if(i.length>0){if(i.length>1){return i}else{return i[0]}}else{return{}}};this.first=function(e,t,n){var r=this.doQuery(e,{query:t,slist:n});if(r.length>0){return r[0]}else{return{}}};this.last=function(e,t,n){var r=this.doQuery(e,{query:t,slist:n});if(r.length>0){return r[r.length-1]}else{return{}}};this.doQuery=function(e,t){var n={fmt:"structured"};if(t.query||t.qid){if(t.query){n.query=t.query}else{n.qid=t.qid}}else{n.query="{'3'.XEX.''}"}n.clist=t.clist||"a";n.slist=t.slist;n.options=t.options;var r=BaseConnect.post(e,"DoQuery",{},n);var i=BaseConnect.getRecords(r,"records");return i};this.doQueryCount=function(e,t){var n=this.doQuery(e,{query:t,clist:"3"});return n.length};this.purgeRecords=function(e,t){var n=BaseConnect.post(e,"PurgeRecords",{},{query:t});var r=BaseConnect.getNode(n,"num_records_deleted");return parseInt(r)};this.importRecords=function(e,t){var n="";var r=[];for(key in t[0]){r.push(key)}r=r.join(".");for(var i=0;i<t.length;i++){var s=t[i];var o=[];for(key in s){value=s[key];value=value.replace(/"/g,'""');o.push('"'+value+'"')}o.join(",");o+="\n";n+=o}var u=BaseConnect.post(e,"ImportFromCSV",{},{clist:r},n);var a=BaseConnect.getRids(u);return a};this.getTableFields=function(e){var t=BaseConnect.post(e,"GetSchema");var n=BaseConnect.getFields(t);return n}}var BaseHelpers={getUrlParam:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return n==null?"":decodeURIComponent(n[1].replace(/\+/g," "))},dateToString:function(e){var t=new Date(parseInt(e));var n=BaseConnect.formatDateElement(t.getMonth()+1);var r=BaseConnect.formatDateElement(t.getDate());t=[n,r,t.getFullYear()].join("-");return t},dateTimeToString:function(e){var t=new Date(parseInt(e));var n=BaseConnect.formatDateElement(t.getMonth()+1);var r=BaseConnect.formatDateElement(t.getDate());var i=BaseConnect.formatDateElement(t.getHours());var s=BaseConnect.formatDateElement(t.getMinutes());var o=BaseConnect.formatDateElement(t.getSeconds());var u=[n,r,t.getFullYear()].join("-");u+=" ";u+=[i,s,o].join(":");return u}};var BaseConnect={post:function(e,t,n,r,i){var s=this.buildRequest();for(key in r){var o=r[key];if(key=="clist"||key=="slist"||key=="options"){if(Object.prototype.toString.call(o)=="[object Array]"){o=o.join(".")}}this.addParameter(s,key,o)}for(key in n){this.addFieldParameter(s,key,n[key])}if(i){var u=s.createElement("records_csv");u.appendChild(s.createCDATASection(i));s.documentElement.appendChild(u)}response=this.xmlPost(e,"API_"+t,s);return response},formatDateElement:function(e){e=e.toString();if(e.length==1){e="0"+e}return e},getNode:function(e,t){return $(e).find(t).text()},getRecords:function(e){var t=$(e).find("records").find("record");var n=[];for(var r=0;r<t.length;r++){var i=t[r];var s=$(i).find("f");i={};for(var o=0;o<s.length;o++){var u=s[o];var a=parseInt($(u).attr("id"));if($(u).find("url").text()!=""){var f=$(u).find("url").text();var l=f.split("/");var c=l[l.length-1];var h={filename:c,url:f}}else{var h=$(u).text()}i[a]=h}n.push(i)}return n},getRids:function(e){var t=$(e).find("rids").find("rid");var n=[];for(var r=0;r<t.length;r++){var i=parseInt($(t[r]).text());n.push(i)}return n},getFields:function(e){var t=$(response).find("fields").find("field");var n=[];for(var r=0;r<t.length;r++){var i=t[r];var s={label:$(i).find("label").text(),nowrap:$(i).find("nowrap").text(),bold:$(i).find("bold").text(),required:$(i).find("required").text(),appears_by_default:$(i).find("appears_by_default").text(),find_enabled:$(i).find("find_enabled").text(),allow_new_choices:$(i).find("allow_new_choices").text(),sort_as_given:$(i).find("sort_as_given").text(),carrychoices:$(i).find("carrychoices").text(),foreignkey:$(i).find("foreignkey").text(),unique:$(i).find("unique").text(),doesdatacopy:$(i).find("doesdatacopy").text(),fieldhelp:$(i).find("fieldhelp").text(),display_user:$(i).find("display_user").text(),default_kind:$(i).find("default_kind").text()};n.push(s)}return n},createDocument:function(){try{if(window.ActiveXObject!==undefined){return new ActiveXObject("Microsoft.XmlDom")}if(document.implementation&&document.implementation.createDocument){var e=document.implementation.createDocument("","",null);return e}}catch(t){}throw new Error("Sorry. Your browser does not support Base.js.")},buildRequest:function(){var e=this.createDocument();e.async=false;e.resolveExternals=false;var t=e.createElement("qdbapi");try{e.removeChild(e.documentElement)}catch(n){}e.appendChild(t);if(this.apptoken){this.addParameter(e,"apptoken",this.apptoken)}return e},addParameter:function(e,t,n){var r=e.documentElement;var i=e.createElement(t);var s=e.createTextNode(n);i.appendChild(s);r.appendChild(i)},addFieldParameter:function(e,t,n){var r=e.documentElement;var i=e.createElement("field");i.setAttribute("fid",t);var s=e.createTextNode(n);i.appendChild(s);r.appendChild(i)},xmlPost:function(e,t,n){var r="/db/"+e+"?act="+t;Base.httpConnection.open("POST",r,false);if(/MSIE 1/i.test(navigator.appVersion)||window.ActiveXObject!==undefined){try{Base.httpConnection.responseType="msxml-document"}catch(i){}}Base.httpConnection.setRequestHeader("Content-Type","text/xml");Base.httpConnection.send(n);var s=Base.httpConnection.responseXML;var o=BaseConnect.getNode(s,"errcode");if(o!="0"){throw new Error("ERROR: code - "+o+" message - "+BaseConnect.getNode(s,"errtext"))}this.ticket=BaseConnect.getNode(s,"ticket");return s},initHttpConnection:function(){try{if(!Base.httpConnection){Base.httpConnection=new XMLHttpRequest}}catch(e){}try{if(!Base.httpConnection){Base.httpConnection=new ActiveXObject("Msxml2.XMLHTTP")}}catch(e){}try{if(!Base.httpConnection){Base.httpConnection=new ActiveXObject("Microsoft.XMLHTTP")}}catch(e){alert("This browser does not support BaseJS.")}}}